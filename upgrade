Fichier: src/Controller/AdminController.php
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/src/Controller/AdminController.php
-----
<?php
// src/Controller/AdminController.php

namespace App\Controller;

use App\Entity\User;
use App\Repository\UserRepository;
use Doctrine\ORM\EntityManagerInterface;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\RedirectResponse;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;

#[Route('/admin')]
class AdminController extends AbstractController
{
#[Route('/', name: 'admin_dashboard')]
public function index(UserRepository $userRepo): Response
{
$jobSeekers = $userRepo->findBy(['type' => 'job_seeker']);
$companies = $userRepo->findBy(['type' => 'company']);

return $this->render('admin/index.html.twig', [
'jobSeekers' => $jobSeekers,
'companies' => $companies,
]);
}

#[Route('/company/approve/{id}', name: 'admin_approve_company')]
public function approveCompany(User $user, EntityManagerInterface $em): RedirectResponse
{
$user->setIsApproved(true);
$em->flush();

$this->addFlash('success', 'Entreprise approuv√©e avec succ√®s !');
return $this->redirectToRoute('admin_dashboard');
}

#[Route('/company/reject/{id}', name: 'admin_reject_company')]
public function rejectCompany(User $user, EntityManagerInterface $em): RedirectResponse
{
$em->remove($user);
$em->flush();

$this->addFlash('danger', 'Entreprise rejet√©e.');
return $this->redirectToRoute('admin_dashboard');
}
}
==================================================

Fichier: src/Controller/AdminDemandesController.php
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/src/Controller/AdminDemandesController.php
-----
<?php

// src/Controller/AdminDemandesController.php
namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use App\Service\UserService;
use App\Entity\User; // ‚¨ÖÔ∏è Ajout√© ici pour utiliser "User" dans array_filter

class AdminDemandesController extends AbstractController
{
    private UserService $userService;

    public function __construct(UserService $userService)
    {
        $this->userService = $userService;
    }

    #[Route('/admin/demandes', name: 'admin_demandes')]
    public function index(): Response
    {
        // R√©cup√®re toutes les entreprises
        $entreprises = $this->userService->findUsersByRole('ROLE_COMPANY');

        // Filtre celles non approuv√©es
        $entreprisesEnAttente = array_filter($entreprises, fn(User $user) => !$user->isApproved());

        return $this->render('admin/demandes/index.html.twig', [
            'entreprises' => $entreprisesEnAttente,
            'message' => $this->get('session')->getFlashBag()->get('message', [])
        ]);
    }

    #[Route('/admin/demandes/approuver/{email}', name: 'admin_demandes_approuver')]
    public function approuver(string $email): Response
    {
        $user = $this->userService->findOneByEmail($email);

        if ($user && $user->getType() === 'company') {
            $this->userService->validateUser($user);
            $this->addFlash('message', 'Entreprise approuv√©e avec succ√®s !');
        } else {
            $this->addFlash('message', '√âchec de l\'approbation.');
        }

        return $this->redirectToRoute('admin_demandes');
    }

    #[Route('/admin/demandes/rejeter/{email}', name: 'admin_demandes_rejeter')]
    public function rejeter(string $email): Response
    {
        $user = $this->userService->findOneByEmail($email);

        if ($user && $user->getType() === 'company') {
            $this->userService->deleteUser($user);
            $this->addFlash('message', 'Entreprise rejet√©e avec succ√®s !');
        } else {
            $this->addFlash('message', '√âchec du rejet.');
        }

        return $this->redirectToRoute('admin_demandes');
    }
}==================================================

Fichier: src/Controller/AdminGestionUtilisateursController.php
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/src/Controller/AdminGestionUtilisateursController.php
-----
<?php

namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\Security\Http\Attribute\IsGranted;

#[IsGranted('ROLE_ADMIN')] // üîê Acc√®s r√©serv√© aux utilisateurs avec le r√¥le admin
class AdminGestionUtilisateursController extends AbstractController
{
    #[Route('/admin/gestion-utilisateurs', name: 'admin_gestion_utilisateurs')]
    public function index(): Response
    {
        return $this->render('admin/gestion_utilisateurs/index.html.twig');
    }

    #[Route('/admin/entreprises', name: 'admin_entreprises')]
    public function entreprises(): Response
    {
        // Exemple de donn√©es √† remplacer par des donn√©es r√©elles (BDD ou service)
        $entreprises = [];

        return $this->render('admin/gestion_utilisateurs/entreprises.html.twig', [
            'entreprises' => $entreprises
        ]);
    }

    #[Route('/admin/chercheurs-emploi', name: 'admin_chercheurs_emploi')]
    public function chercheursEmploi(): Response
    {
        // Exemple de donn√©es √† remplacer par des donn√©es r√©elles
        $chercheurs = [];

        return $this->render('admin/gestion_utilisateurs/chercheurs.html.twig', [
            'chercheurs' => $chercheurs
        ]);
    }

    #[Route('/admin/home', name: 'admin_home')]
    public function home(): Response
    {
        return $this->render('admin/home/index.html.twig'); // Page d'accueil admin
    }
}==================================================

Fichier: src/Controller/AdminHomeController.php
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/src/Controller/AdminHomeController.php
-----
<?php

namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\Security\Http\Attribute\IsGranted;

#[IsGranted('ROLE_ADMIN')] // üîê Prot√®ge l'acc√®s √† toutes les routes du contr√¥leur
#[Route('/admin')]
class AdminHomeController extends AbstractController
{
    #[Route('/', name: 'admin_home', methods: ['GET'])]
    public function index(): Response
    {
        return $this->render('admin/home/index.html.twig');
    }
}==================================================

Fichier: src/Controller/AdminToutesEntreprisesController.php
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/src/Controller/AdminToutesEntreprisesController.php
-----
<?php
// src/Controller/AdminToutesEntreprisesController.php

namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\Security\Http\Attribute\IsGranted;
use App\Repository\UserRepository;

#[IsGranted('ROLE_ADMIN')] // üîê Acc√®s r√©serv√© aux admins
#[Route('/admin')]
class AdminToutesEntreprisesController extends AbstractController
{
#[Route('/entreprises', name: 'admin_toutes_entreprises', methods: ['GET'])]
public function index(UserRepository $userRepository): Response
{
// R√©cup√®re toutes les entreprises (type = 'company')
$entreprises = $userRepository->findBy(['type' => 'company']);

return $this->render('admin/toutes_entreprises/index.html.twig', [
'entreprises' => $entreprises,
]);
}
}==================================================

Fichier: src/Controller/CreateAdminController.php
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/src/Controller/CreateAdminController.php
-----
<?php
// src/Controller/CreateAdminController.php

namespace App\Controller;

use App\Entity\Administrateur;
use App\Form\AdministrateurType;
use Doctrine\ORM\EntityManagerInterface;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\PasswordHasher\Hasher\UserPasswordHasherInterface; // Modification ici

class CreateAdminController extends AbstractController
{
    #[Route("/admin/create", name: "create_admin")]
    public function create(
        Request $request,
        EntityManagerInterface $entityManager,
        UserPasswordHasherInterface $passwordHasher // Modification ici
    ): Response
    {
        $administrateur = new Administrateur();
        $form = $this->createForm(AdministrateurType::class, $administrateur);
        $form->handleRequest($request);

        if ($form->isSubmitted() && $form->isValid()) {
            // R√©cup√©ration du mot de passe en clair
            $plainPassword = $administrateur->getMotdepasse();

            // Hachage avec la nouvelle interface
            $hashedPassword = $passwordHasher->hashPassword(
                $administrateur,
                $plainPassword
            );

            $administrateur->setMotdepasse($hashedPassword);

            $entityManager->persist($administrateur);
            $entityManager->flush();

            $this->addFlash('success', 'Administrateur cr√©√© avec succ√®s !');
            return $this->redirectToRoute('app_login');
        }

        return $this->render('admin/create.html.twig', [
            'form' => $form->createView(),
        ]);
    }
}==================================================

Fichier: templates/admin/demandes/index.html.twig
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/templates/admin/demandes/index.html.twig
-----
{# templates/admin/demandes/index.html.twig #}
{% extends 'admin/base-admin.html.twig' %}

{% block title %}Demandes des entreprises{% endblock %}

{% block content %}
    <h1 class="mb-4">Demandes d'entreprises en attente</h1>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Email</th>
            <th>Nom de l'entreprise</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for entreprise in entreprises %}
            <tr>
                <td>{{ entreprise.email }}</td>
                <td>{{ entreprise.nom }}</td>
                <td>
                    <a href="{{ path('admin_demandes_approuver', {'id': entreprise.id}) }}" class="btn btn-success btn-sm">Approuver</a>
                    <a href="{{ path('admin_demandes_rejeter', {'id': entreprise.id}) }}" class="btn btn-danger btn-sm">Rejeter</a>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="3" class="text-center">Aucune demande trouv√©e.</td></tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}==================================================

Fichier: templates/admin/GestionUtilisateurs/chercheurs.html.twig
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/templates/admin/GestionUtilisateurs/chercheurs.html.twig
-----
{# templates/admin/gestion_utilisateurs/chercheurs.html.twig #}
{% extends 'admin/base-admin.html.twig' %}

{% block title %}Gestion des candidats{% endblock %}

{% block content %}
    <h1>Liste des candidats</h1>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Nom complet</th>
            <th>Email</th>
            <th>Date d'inscription</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% if chercheurs|length > 0 %}
            {% for user in chercheurs %}
                <tr>
                    <td>{{ user.firstName }} {{ user.lastName }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.createdAt ? user.createdAt|date('d/m/Y') : '-' }}</td>
                    <td>
                        <a href="#" class="btn btn-sm btn-primary">Voir profil</a>
                    </td>
                </tr>
            {% endfor %}
        {% else %}
            <tr><td colspan="4" class="text-center">Aucun candidat trouv√©.</td></tr>
        {% endif %}
        </tbody>
    </table>
{% endblock %}==================================================

Fichier: templates/admin/GestionUtilisateurs/entreprise.html.twig
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/templates/admin/GestionUtilisateurs/entreprise.html.twig
-----
{# templates/admin/gestion_utilisateurs/entreprises.html.twig #}
{% extends 'admin/base-admin.html.twig' %}

{% block title %}Gestion des entreprises{% endblock %}

{% block content %}
    <h1>Liste des entreprises</h1>

    <table class="table table-bordered">
        <thead>
        <tr>
            <th>Nom</th>
            <th>Email</th>
            <th>Statut</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% if entreprises|length > 0 %}
            {% for entreprise in entreprises %}
                <tr>
                    <td>{{ entreprise.nom }}</td>
                    <td>{{ entreprise.email }}</td>
                    <td>
                        {% if entreprise.isApproved %}
                            <span class="badge bg-success">‚úÖ Approuv√©e</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">‚è≥ En attente</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="#" class="btn btn-sm btn-primary">Voir d√©tails</a>
                    </td>
                </tr>
            {% endfor %}
        {% else %}
            <tr><td colspan="4" class="text-center">Aucune entreprise trouv√©e.</td></tr>
        {% endif %}
        </tbody>
    </table>
{% endblock %}==================================================

Fichier: templates/admin/GestionUtilisateurs/index.html.twig
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/templates/admin/GestionUtilisateurs/index.html.twig
-----
{# templates/admin/gestion_utilisateurs/index.html.twig #}
{% extends 'admin/base-admin.html.twig' %}

{% block title %}Gestion des utilisateurs{% endblock %}

{% block content %}
    <h1>Gestion des utilisateurs</h1>

    <ul class="list-group">
        <li class="list-group-item">
            <a href="{{ path('admin_entreprises') }}">üè¢ G√©rer les entreprises</a>
        </li>
        <li class="list-group-item">
            <a href="{{ path('admin_chercheurs_emploi') }}">üë§ G√©rer les candidats</a>
        </li>
    </ul>
{% endblock %}==================================================

Fichier: templates/admin/base-admin.html.twig
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/templates/admin/base-admin.html.twig
-----
{# templates/admin/base-admin.html.twig #}
{% extends 'base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap @5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
{% endblock %}

{% block body %}
    <div class="container-fluid">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4 mt-2 rounded">
            <div class="container-fluid">
                <a class="navbar-brand" href="{{ path('admin_home') }}">Administration</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link" href="{{ path('admin_home') }}">üè† Accueil</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ path('admin_demandes') }}">üì• Demandes</a></li>
                        <li class="nav-item"><a class="nav-link" href="{{ path('admin_gestion_utilisateurs') }}">üë• Utilisateurs</a></li>
                    </ul>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#">üë§ Connect√© en tant qu'Admin</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Messages Flash -->
        {% for label, messages in app.flashes(['success', 'danger']) %}
            {% for message in messages %}
                <div class="alert alert-{{ label == 'success' ? 'success' : 'danger' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        {% endfor %}

        <!-- Contenu principal -->
        <div class="row">
            <div class="col-md-12">
                {% block content %}{% endblock %}
            </div>
        </div>
    </div>
{% endblock %}
<li class="nav-item"><a class="nav-link" href="{{ path('admin_toutes_entreprises') }}">üè¢ Toutes les entreprises</a></li>==================================================

Fichier: templates/admin/create.html.twig
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/templates/admin/create.html.twig
-----
{# templates/admin/create.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Cr√©er un administrateur{% endblock %}

{% block body %}
    <div class="container mt-5">
        <h1>Cr√©er un administrateur</h1>

        {# Messages flash #}
        {% for message in app.flashes('error') %}
            <div class="alert alert-danger">{{ message }}</div>
        {% endfor %}

        {% for message in app.flashes('success') %}
            <div class="alert alert-success">{{ message }}</div>
        {% endfor %}

        {# Formulaire Symfony #}
        {{ form_start(form) }}
        <div class="mb-3">
            {{ form_label(form.username) }}
            {{ form_widget(form.username, {'attr': {'class': 'form-control'}}) }}
            {{ form_errors(form.username) }}
        </div>

        <div class="mb-3">
            {{ form_label(form.email) }}
            {{ form_widget(form.email, {'attr': {'class': 'form-control'}}) }}
            {{ form_errors(form.email) }}
        </div>

        <div class="mb-3">
            {{ form_label(form.motdepasse) }}
            {{ form_widget(form.motdepasse, {'attr': {'class': 'form-control'}}) }}
            {{ form_errors(form.motdepasse) }}
        </div>

        <div class="mb-3">
            {{ form_label(form.prenom) }}
            {{ form_widget(form.prenom, {'attr': {'class': 'form-control'}}) }}
            {{ form_errors(form.prenom) }}
        </div>

        <div class="mb-3">
            {{ form_label(form.nomComplet) }}
            {{ form_widget(form.nomComplet, {'attr': {'class': 'form-control'}}) }}
            {{ form_errors(form.nomComplet) }}
        </div>

        <button type="submit" class="btn btn-primary">Cr√©er</button>
        {{ form_end(form) }}
    </div>
{% endblock %}==================================================

Fichier: templates/admin/index.html.twig
Chemin complet: /Users/fadilimeme/Desktop/esprimcareer/workshope/templates/admin/index.html.twig
-----
{# templates/admin/index.html.twig #}
{% extends 'admin/base-admin.html.twig' %}

{% block title %}Tableau de bord Admin{% endblock %}

{% block content %}
    <h1 class="mb-4">Tableau de bord Administrateur</h1>

    <div class="row">
        <div class="col-md-6">
            <h2>Candidats</h2>
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Nom complet</th>
                    <th>Email</th>
                </tr>
                </thead>
                <tbody>
                {% for user in jobSeekers %}
                    <tr>
                        <td>{{ user.firstName }} {{ user.lastName }}</td>
                        <td>{{ user.email }}</td>
                    </tr>
                {% else %}
                    <tr><td colspan="2">Aucun candidat trouv√©.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="col-md-6">
            <h2>Entreprises en attente</h2>
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Email</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                {% for company in companies if not company.isApproved %}
                    <tr>
                        <td>{{ company.email }}</td>
                        <td>
                            <a href="{{ path('admin_approve_company', {'id': company.id}) }}" class="btn btn-success btn-sm">‚úÖ Approuver</a>
                            <a href="{{ path('admin_reject_company', {'id': company.id}) }}" class="btn btn-danger btn-sm">‚ùå Rejeter</a>
                        </td>
                    </tr>
                {% else %}
                    <tr><td colspan="2">Aucune entreprise en attente.</td></tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}==================================================

